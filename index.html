<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ponche of the Day</title>
        <link rel="icon" type="image/png" href="source_images/ponche-pal-logo.png">
        <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    </head>
    <body>
        <div class="container">
        <header class="header">
            <div class="header-content">
                <img src="source_images/ponche-pal-logo.png" alt="Ponche Pal Logo" class="logo">
                <h1 class="title">Ponche of the Day</h1>
            </div>
        </header>

        <main class="main-content">
                        <div class="song-container">
                <div class="song-info" id="songInfo">
                    <div class="loading">Loading song data...</div>
                </div>
            </div>

            <!-- Removed context-section textarea -->

            <button id="newPoncheBtn" class="new-ponche-btn" onclick="showNewPonche()">I'm feeling lucky</button>

            <div class="discussion-link">
                <p>Questions? Want to discuss? <a href="https://ponchepal.substack.com" target="_blank">https://ponchepal.substack.com</a></p>
            </div>
        </main>
                    </div>

    <script>
        // Load ponche data from external JSON file
        
        let poncheData = [];

        async function initializeData() {
            try {
                const response = await fetch('ponche_data.json');
                const data = await response.json();
                poncheData = data.filter(ponche => ponche.song && ponche.song.trim() !== '');
                console.log(`âœ… Loaded ${poncheData.length} ponches`);
                showNewPonche();
                return true;
            } catch (error) {
                console.error('Error loading ponche data:', error);
                const songInfo = document.getElementById('songInfo');
                songInfo.innerHTML = '<div class="error">Error loading song data</div>';
                return false;
            }
        }

        let currentSong = '';
        let currentArtist = '';

        // Convert time format (MM:SS) to seconds for YouTube start time
        function getYouTubeStartTime(timeString) {
            if (!timeString || timeString === 'N/A') return 0;
            
            const parts = timeString.split(':');
            if (parts.length === 2) {
                const minutes = parseInt(parts[0]);
                const seconds = parseInt(parts[1]);
                return (minutes * 60) + seconds;
            }
            return 0;
        }

        // Extract YouTube video ID from full URL
        function extractYouTubeId(youtubeUrl) {
            if (!youtubeUrl) return '';
            
            // Handle youtu.be URLs
            if (youtubeUrl.includes('youtu.be/')) {
                const match = youtubeUrl.match(/youtu\.be\/([^?]+)/);
                return match ? match[1] : '';
            }
            
            // Handle youtube.com URLs
            if (youtubeUrl.includes('youtube.com/')) {
                const match = youtubeUrl.match(/[?&]v=([^&]+)/);
                return match ? match[1] : '';
            }
            
            // If it's already just an ID, return as is
            if (youtubeUrl.length === 11) {
                return youtubeUrl;
            }
            
            return '';
        }

        // Create YouTube URL with start time
        function createYouTubeUrlWithTime(youtubeUrl, timeInSeconds) {
            if (!youtubeUrl || !timeInSeconds) return youtubeUrl;
            
            // Handle youtu.be URLs
            if (youtubeUrl.includes('youtu.be/')) {
                const separator = youtubeUrl.includes('?') ? '&' : '?';
                return `${youtubeUrl}${separator}t=${timeInSeconds}`;
            }
            
            // Handle youtube.com URLs
            if (youtubeUrl.includes('youtube.com/')) {
                const separator = youtubeUrl.includes('?') ? '&' : '?';
                return `${youtubeUrl}${separator}t=${timeInSeconds}`;
            }
            
            return youtubeUrl;
        }

        // Display song information
        function displaySong(songData) {
            const songInfo = document.getElementById('songInfo');
            
            if (!songData) {
                songInfo.innerHTML = '<div class="error">Error loading song data</div>';
                return;
            }

            // Extract data from the JSON object
            const song = songData.song || 'Unknown Song';
            const artist = songData.artist || 'Unknown Artist';
            const poncheType = songData.ponche_type || '';
            const time = songData.time || '';
            const timeForAttention = songData.time_for_attention || '';
            const preMusicality = songData.pre_musicality_measure_length || '';
            const sizeProminence = songData.size_prominence || '';
            const hint = songData['hint for cantante'] || '';
            const youtubeUrl = songData.youtube_id || '';
            const youtubeId = extractYouTubeId(youtubeUrl);

            songInfo.innerHTML = `<div class="song-header">
                    <h2 class="song-title">${song}</h2>
                    <p class="song-artist">by ${artist}</p>
                </div>${youtubeId ? `<div class="video-section">
                    <h3 class="video-title">Watch this ponche in action!</h3>
                    <div class="video-container">
                        <a href="${createYouTubeUrlWithTime(youtubeUrl, getYouTubeStartTime(timeForAttention))}" target="_blank" class="video-thumbnail-link">
                            <div class="video-thumbnail">
                                <img src="https://img.youtube.com/vi/${youtubeId}/maxresdefault.jpg" 
                                     alt="Video thumbnail" 
                                     onerror="this.src='https://img.youtube.com/vi/${youtubeId}/hqdefault.jpg'">
                                <div class="play-button">
                                    <svg width="68" height="48" viewBox="0 0 68 48">
                                        <path class="play-button-shape" d="M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z"></path>
                                        <path class="play-button-icon" d="M 45,24 27,14 27,34"></path>
                                    </svg>
                                </div>
                                <div class="video-info">
                                    <span class="video-time">${timeForAttention || time}</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>` : ''}<div class="song-details">
                    <div class="detail-item">
                        <span class="detail-label">Ponche Type:</span>
                        <span class="detail-value">${poncheType || 'N/A'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Time:</span>
                        <span class="detail-value">${time || 'N/A'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Time for Attention:</span>
                        <span class="detail-value">${timeForAttention || 'N/A'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Pre-Musicality:</span>
                        <span class="detail-value">${preMusicality || 'N/A'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Size/Prominence:</span>
                        <span class="detail-value">${sizeProminence || 'N/A'}</span>
                    </div>${hint ? `<div class="detail-item hint">
                        <span class="detail-label">Hint:</span>
                        <span class="detail-value">${hint}</span>
                    </div>` : ''}
                </div>`;

            // Update current song info
            currentSong = song;
            currentArtist = artist;
        }

        // Get a random song
        function getRandomSong() {
            if (poncheData.length === 0) return null;
            
            const randomIndex = Math.floor(Math.random() * poncheData.length);
            return poncheData[randomIndex];
        }

        // Show a new random ponche
        function showNewPonche() {
            const randomSong = getRandomSong();
            if (randomSong) {
                displaySong(randomSong);
            }
        }

        // Initialize the page
        function initializePage() {
            initializeData();
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', initializePage);

        // Make functions globally available
        window.showNewPonche = showNewPonche;
    </script>
    </body>
</html>
